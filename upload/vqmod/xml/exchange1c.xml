<modification>
	<id><![CDATA[exchange1c]]></id>
	<version><![CDATA[1.1]]></version>
	<vqmver><![CDATA[]]></vqmver>
	<author><![CDATA[zenwalker (http://zenwalker.ru/)]]></author>

	<file name="admin/controller/common/menu.php">
		<operation>
			<search position="after"><![CDATA[$data['feed'] = $this->url->link('extension/feed', 'token=' . $this->session->data['token'], 'SSL');]]></search>
			<add><![CDATA[$data['exchange1c'] = $this->url->link('module/exchange1c', 'token=' . $this->session->data['token'], 'SSL');]]></add>
		</operation>
	</file>

	<file name="admin/view/template/common/menu.tpl">
		<operation>
			<search position="after"><![CDATA[<li><a href="<?php echo $feed; ?>"><?php echo $text_feed; ?></a></li>]]></search>
			<add><![CDATA[<li><a href="<?php echo $exchange1c; ?>">Exchange 1C</a></li>]]></add>
		</operation>
	</file>

	<file name="system/library/image.php">
		<operation>
			<search position="replace"><![CDATA[$this->image = $this->create($file);]]></search>
			<add><![CDATA[$this->image = $this->create($file, 'auto');]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[private function create($image) {]]></search>
			<add><![CDATA[private function create($image, $mime) {
        if ($mime == 'auto')]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[public function watermark($file, $position = 'bottomright') {]]></search>
			<add><![CDATA[public function watermark($file, $position = 'bottomright', $mime = 'auto') {]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$watermark = $this->create($file);]]></search>
			<add><![CDATA[$watermark = $this->create($file, $mime);]]></add>
		</operation>
		<operation info="add 'center' for watermark">
			<search position="before"><![CDATA[case 'bottomright':]]></search>
			<add><![CDATA[
			case 'center':
				$watermark_pos_x = ($this->info['width'])/3;
				$watermark_pos_y = ($this->info['height'])/3;
				break;
			]]></add>
		</operation>
		<operation info="imagecopy to imagecopyresized">
			<search position="replace"><![CDATA[imagecopy($this->image, $watermark, $watermark_pos_x, $watermark_pos_y, 0, 0, 120, 40);]]></search>
			<add><![CDATA[
			$new_watermark_width = $this->info['width'];
			$new_watermark_height = $this->info['height'];
			if ($watermark_width > 0) {
				$new_watermark_width = $this->info['width'];
				$new_watermark_height = $watermark_height * $this->info['width'] / $watermark_width;
			}
			imagecopyresized ($this->image , $watermark, 0, $watermark_pos_y, 0, 0, $new_watermark_width, $new_watermark_height, $watermark_width, $watermark_height);
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$merge = $this->create($file);]]></search>
			<add><![CDATA[$merge = $this->create($file, 'auto');]]></add>
		</operation>
	</file>

	<file name="admin/model/sale/order.php">
		<operation>
			<search position="replace"><![CDATA[public function getTotalOrdersByStoreId($store_id) {]]></search>
			<add><![CDATA[	public function getOrderStatus($order_id) {
		$order_status_id = $this->db->query("SELECT order_status_id FROM `" . DB_PREFIX . "order` WHERE order_id = '" . (int)$order_id . "'");
        $order_status = $this->db->query("SELECT name FROM `" . DB_PREFIX . "order_status` WHERE order_status_id = " . $order_status_id->row['order_status_id'] . " AND language_id = '" . (int)$this->config->get('config_language_id') . "'");

        return $order_status->row['name'];
    }     
	
	public function getOrderPay($order_id) {
		$pay_status = $this->db->query("SELECT payment_method FROM `" . DB_PREFIX . "order` WHERE order_id = '" . (int)$order_id . "'");
	
        return $pay_status->row['payment_method'];
    }     

	public function getOrderShipping($order_id) {
		$pay_status = $this->db->query("SELECT shipping_method FROM `" . DB_PREFIX . "order` WHERE order_id = '" . (int)$order_id . "'");
	
        return $pay_status->row['shipping_method'];
    }     
	
	public function getTotalOrdersByStoreId($store_id) {]]></add>
		</operation>
	</file>	
</modification>